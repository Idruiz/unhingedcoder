<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Prompt Architect – Unhinged Codex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #f5f5f7;
        --panel: #ffffff;
        --border: #d0d0e0;
        --accent: #2563eb;
        --accent-soft: #e0ebff;
        --text-main: #111827;
        --text-muted: #6b7280;
        --radius-lg: 12px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: var(--bg);
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        padding: 12px 20px;
        background: #ffffff;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      header h1 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
      }

      header span {
        font-size: 12px;
        color: var(--text-muted);
      }

      main {
        flex: 1;
        padding: 12px 16px 16px;
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
        gap: 12px;
      }

      .panel {
        background: var(--panel);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        padding: 12px;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      h2 {
        margin: 0 0 8px;
        font-size: 14px;
      }

      .field-group {
        display: grid;
        grid-template-columns: 1.1fr 1.9fr;
        gap: 8px 10px;
        font-size: 13px;
        align-items: flex-start;
      }

      .field-group label {
        margin-top: 6px;
        font-weight: 500;
      }

      textarea,
      input[type="text"],
      select {
        width: 100%;
        border-radius: 8px;
        border: 1px solid var(--border);
        padding: 6px 8px;
        font-family: inherit;
        font-size: 13px;
        background: #ffffff;
      }

      textarea {
        resize: vertical;
        min-height: 60px;
      }

      select {
        background: #ffffff;
      }

      textarea:focus,
      input[type="text"]:focus,
      select:focus {
        outline: 2px solid rgba(37, 99, 235, 0.15);
        border-color: var(--accent);
      }

      .hint {
        font-size: 11px;
        color: var(--text-muted);
        margin-top: 2px;
      }

      .preset-block {
        display: flex;
        flex-direction: column;
        gap: 4px;
        margin-bottom: 4px;
      }

      .button-row {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      button {
        border-radius: 999px;
        border: 1px solid transparent;
        padding: 6px 14px;
        font-size: 13px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: var(--accent);
        color: #ffffff;
      }

      button.secondary {
        background: #ffffff;
        color: var(--text-main);
        border-color: var(--border);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .status {
        margin-top: 6px;
        font-size: 11px;
        color: var(--text-muted);
      }

      .status.error {
        color: #b91c1c;
      }

      .output-textarea {
        flex: 1;
        min-height: 0;
        resize: none;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo,
          Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 12px;
        white-space: pre-wrap;
        background: #f9fafb;
      }

      footer {
        padding: 6px 16px 10px;
        font-size: 11px;
        color: var(--text-muted);
        text-align: center;
      }

      @media (max-width: 1000px) {
        main {
          grid-template-columns: 1fr;
        }

        .field-group {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div>
        <h1>Prompt Architect</h1>
        <span>Over-engineered, zero-drift superprompts for Unhinged Codex</span>
      </div>
      <span class="hint"
        >Use presets + your own text. It will always build a prompt, even with
        gaps.</span
      >
    </header>

    <main>
      <!-- LEFT: Prompt components -->
      <section class="panel">
        <h2>Prompt Inputs</h2>
        <div class="field-group">
          <!-- Project name / context -->
          <label for="projectName">Project name / context</label>
          <div>
            <input
              id="projectName"
              type="text"
              placeholder="e.g., Golpe Vocal – pronunciation heist game"
            />
            <div class="hint">
              One line that anchors the whole thing (course, game, tool, etc.).
            </div>
          </div>

          <!-- Overall goal -->
          <label for="goal">Overall goal</label>
          <div>
            <textarea
              id="goal"
              placeholder="What should this codebase actually achieve? Gameplay, workflows, teacher UX, etc."
            ></textarea>
          </div>

          <!-- Tech stack + platform -->
          <label for="stack">Tech stack + platform</label>
          <div>
            <div class="preset-block">
              <select id="stackPreset">
                <option value="">Select a preset (optional)</option>
                <option
                  value="Primary stack: Google Apps Script backend (server-side .gs) + HTML/JS frontend served as a web app. Deployed via Apps Script, no external DB. Teacher-friendly deployment from script editor."
                >
                  Apps Script web app (GS + HTML/JS)
                </option>
                <option
                  value="Primary stack: Static HTML + vanilla JavaScript + CSS. No bundler, no framework, must run directly from a single index.html hosted via GitHub Pages or Render static hosting."
                >
                  Static HTML + vanilla JS (no build)
                </option>
                <option
                  value="Primary stack: Node.js + Express backend with REST endpoints, serving a static HTML/JS frontend. Single Node service deployed on Render."
                >
                  Node + Express + static frontend (Render)
                </option>
                <option
                  value="Primary stack: React + Vite + TypeScript, single-page app. Deployed on Render. Clean separation of components, hooks, and services."
                >
                  React + Vite + TS SPA (Render)
                </option>
                <option
                  value="Primary stack: GitHub repo with a /backend (Node/Express) and /frontend (HTML/JS or React). Both wired for simple deployment from Render."
                >
                  GitHub multi-app (backend + frontend)
                </option>
              </select>
              <div class="hint">
                Choose the closest preset, then add extra details below if
                needed.
              </div>
            </div>
            <textarea
              id="stack"
              placeholder="Extra stack details: libraries allowed/forbidden, browser targets, Render constraints, Apps Script quirks, etc."
            ></textarea>
          </div>

          <!-- Architecture -->
          <label for="architecture">Architecture & structure</label>
          <div>
            <div class="preset-block">
              <select id="architecturePreset">
                <option value="">Select a preset (optional)</option>
                <option
                  value="Architecture: feature-based folders (e.g., /auth, /gameplay, /teacherDash) with each folder containing its own UI, logic, and tests."
                >
                  Feature-based folders
                </option>
                <option
                  value="Architecture: layered (routes/controllers, services, data access) with clear dependency direction and no circular imports."
                >
                  Layered (controllers / services / data)
                </option>
                <option
                  value="Architecture: single-page web app with small ES modules, each file focused on one responsibility, imported via type='module' in index.html."
                >
                  SPA with ES modules
                </option>
                <option
                  value="Architecture: Google Apps Script pattern with Code.gs as entry point, separate .gs files per domain (sheets access, classroom integration, utilities) plus HTML templates for UI."
                >
                  Apps Script multi-file pattern
                </option>
                <option
                  value="Architecture: backend /frontend split with shared types and utilities where appropriate, minimal coupling between UI and persistence."
                >
                  Backend / frontend split
                </option>
              </select>
            </div>
            <textarea
              id="architecture"
              placeholder="Custom folder structure, module boundaries, sheet layouts, data flow (e.g., how GS talks to HTML UI)."
            ></textarea>
          </div>

          <!-- Core features / flows -->
          <label for="features">Core features / flows</label>
          <div>
            <textarea
              id="features"
              placeholder="Bullet list: missions, screens, teacher dashboards, student flows, scoring, logging, etc."
            ></textarea>
          </div>

          <!-- Non-negotiables -->
          <label for="nonnegotiables">Non-negotiables</label>
          <div>
            <div class="preset-block">
              <select id="nonnegPreset">
                <option value="">Select a preset (optional)</option>
                <option
                  value="Non-negotiable: no external build tools beyond npm scripts; must run with simple npm install && npm start on Render."
                >
                  No exotic build chain
                </option>
                <option
                  value="Non-negotiable: no external databases or auth providers; use Google Sheets or in-memory data where reasonable."
                >
                  No external DB/auth
                </option>
                <option
                  value="Non-negotiable: avoid heavy UI frameworks; keep the HTML/JS side lightweight and readable for teachers."
                >
                  Lightweight, teacher-readable UI
                </option>
                <option
                  value="Non-negotiable: no eval, no dynamic script injection, no unsafe HTML; code must be safe for school environments."
                >
                  Safety: no eval / injection
                </option>
                <option
                  value="Non-negotiable: code must stay in a single repo, structured so updates are easy to deploy via GitHub + Render or Apps Script."
                >
                  Single GitHub repo, easy deploy
                </option>
              </select>
            </div>
            <textarea
              id="nonnegotiables"
              placeholder="Anything else you refuse to compromise on."
            ></textarea>
          </div>

          <!-- Tests, logging, safety -->
          <label for="tests">Tests, logging & safety</label>
          <div>
            <div class="preset-block">
              <select id="testsPreset">
                <option value="">Select a preset (optional)</option>
                <option
                  value="Testing: focus on critical logic with Jest-style unit tests for pure functions, plus a few integration-style checks. Logging: small wrapper around console.log for consistent tags."
                >
                  Jest-style unit + console logging
                </option>
                <option
                  value="Testing: minimal but real 'smoke tests' that assert the main flows don't throw. Logging: clear error paths with contextual messages."
                >
                  Smoke tests + clear error logs
                </option>
                <option
                  value="Testing: where running tests is hard (e.g., Apps Script), include a dedicated debug mode and clear instructions for manual testing steps."
                >
                  Manual testing friendly (Apps Script)
                </option>
                <option
                  value="Safety: defensive coding around user input, sheet access, and network calls; all external calls wrapped with try/catch and graceful fallbacks."
                >
                  Defensive coding & fallbacks
                </option>
                <option
                  value="Observability: add simple, toggleable logging flags so teachers can see what's happening in the console without drowning in noise."
                >
                  Toggleable logging flags
                </option>
              </select>
            </div>
            <textarea
              id="tests"
              placeholder="Any extra expectations around tests, logging hooks, or guardrails."
            ></textarea>
          </div>

          <!-- Style & comments -->
          <label for="style">Style & comments</label>
          <div>
            <div class="preset-block">
              <select id="stylePreset">
                <option value="">Select a preset (optional)</option>
                <option
                  value="Style: straightforward, readable code that a busy teacher can scan quickly. Comments explain *why* in short phrases, not essays."
                >
                  Teacher-readable, concise comments
                </option>
                <option
                  value="Style: favor small functions with explicit names over clever one-liners; prioritize clarity over brevity."
                >
                  Small functions, explicit names
                </option>
                <option
                  value="Style: keep all configuration (sheet IDs, ranges, API URLs) centralized in a single config file or block."
                >
                  Centralized configuration
                </option>
                <option
                  value="Style: when in doubt, choose boring, well-known patterns instead of fancy abstractions."
                >
                  Boring, stable patterns
                </option>
                <option
                  value="Style: avoid unnecessary classes; prefer simple modules and plain functions unless object orientation is clearly helpful."
                >
                  Modules + plain functions
                </option>
              </select>
            </div>
            <textarea
              id="style"
              placeholder="Any extra tone or stylistic rules you care about."
            ></textarea>
          </div>

          <!-- Over-engineering & robustness -->
          <label for="overkill">Over-engineering & robustness</label>
          <div>
            <div class="preset-block">
              <select id="overkillPreset">
                <option value="">Select a preset (optional)</option>
                <option
                  value="- This is not an MVP. Aggressively over-engineer for robustness, classroom chaos, and weird edge cases.\n- Prefer extra guardrails, validation, and helpers over minimal code.\n- Add small internal tools (debug panels, admin helpers, seed/reset utilities) if budget allows."
                >
                  Not an MVP: overbuild for robustness
                </option>
                <option
                  value="- Treat every feature and bullet as a binding contract; missing any of them counts as a failure.\n- Err on the side of implementing more than requested, never less, as long as it stays consistent with the theme."
                >
                  Contract mode: no missing features
                </option>
                <option
                  value="- Architect for multi-class reuse: even if user describes one class, structure code so it can be reused across multiple groups with minimal changes."
                >
                  Multi-class, reusable architecture
                </option>
                <option
                  value="- Include explicit state diagrams or state-machine style logic in code (not prose) for core flows, so behavior is predictable under stress."
                >
                  State-machine style core flows
                </option>
                <option
                  value="- Build in reset/restart/safe rollback paths for teachers so they can hard-reset the game/app between classes without editing code."
                >
                  Reset / rollback tools for teachers
                </option>
              </select>
            </div>
            <textarea
              id="overkill"
              placeholder="Extra instructions for overkill behaviors: redundancy, extra safety, internal admin tools, etc."
            ></textarea>
          </div>

          <!-- Constraints / generation strategy -->
          <label for="constraints">Token & generation strategy</label>
          <div>
            <div class="preset-block">
              <select id="constraintsPreset">
                <option value="">Select a preset (optional)</option>
                <option
                  value="- Use the maximum safe output size the API allows.\n- Output all code first, then a short explanation at the end if budget remains."
                >
                  Max tokens, code first
                </option>
                <option
                  value="- Organize the answer into sections per file.\n- Use headers like // file: path/to/file.js so it’s easy to split into real files."
                >
                  File headers with separators
                </option>
                <option
                  value="- No markdown fences around the entire output; treat this as raw code that will be copy-pasted into files."
                >
                  No markdown fences
                </option>
                <option
                  value="- If you must truncate, prioritize core game/app loop, state management, and data structures over cosmetic extras."
                >
                  Prioritize core logic on truncation
                </option>
                <option
                  value="- Never replace code with summaries. Only summarize after writing real, runnable code."
                >
                  Never summarize instead of code
                </option>
              </select>
            </div>
            <textarea
              id="constraints"
              placeholder="Extra instructions on how the answer should be structured across the token budget."
            ></textarea>
            <div class="hint">
              Preset + your text are merged; you can leave this blank and it
              will still generate a prompt.
            </div>
          </div>
        </div>

        <div class="button-row">
          <button id="buildBtn" type="button">Create Prompt</button>
          <button id="resetBtn" class="secondary" type="button">
            Reset Inputs
          </button>
        </div>

        <div id="builderStatus" class="status">
          Ready. This page never calls the API; it only builds text for you.
        </div>
      </section>

      <!-- RIGHT: Final superprompt -->
      <section class="panel">
        <h2>Final Superprompt</h2>
        <textarea
          id="finalPrompt"
          class="output-textarea"
          placeholder="Your assembled superprompt will appear here. Copy it into Unhinged Codex."
        ></textarea>

        <div class="button-row">
          <button id="copyBtn" type="button">Copy to Clipboard</button>
        </div>
      </section>
    </main>

    <footer>
      Prompt Architect runs entirely in this browser tab. No network calls, no
      keys, just structured prompt text for Unhinged Codex.
    </footer>

    <script>
      const fields = {
        projectName: document.getElementById("projectName"),
        goal: document.getElementById("goal"),

        stackPreset: document.getElementById("stackPreset"),
        stack: document.getElementById("stack"),

        architecturePreset: document.getElementById("architecturePreset"),
        architecture: document.getElementById("architecture"),

        features: document.getElementById("features"),

        nonnegPreset: document.getElementById("nonnegPreset"),
        nonnegotiables: document.getElementById("nonnegotiables"),

        testsPreset: document.getElementById("testsPreset"),
        tests: document.getElementById("tests"),

        stylePreset: document.getElementById("stylePreset"),
        style: document.getElementById("style"),

        overkillPreset: document.getElementById("overkillPreset"),
        overkill: document.getElementById("overkill"),

        constraintsPreset: document.getElementById("constraintsPreset"),
        constraints: document.getElementById("constraints"),
      };

      const buildBtn = document.getElementById("buildBtn");
      const resetBtn = document.getElementById("resetBtn");
      const copyBtn = document.getElementById("copyBtn");
      const finalPrompt = document.getElementById("finalPrompt");
      const statusEl = document.getElementById("builderStatus");

      function mergePresetAndText(presetEl, textEl) {
        const pieces = [];
        const preset = presetEl?.value?.trim();
        const text = textEl?.value?.trim();
        if (preset) pieces.push(preset);
        if (text) pieces.push(text);
        return pieces.join("\n");
      }

      function buildSuperprompt() {
        statusEl.classList.remove("error");

        const name =
          fields.projectName.value.trim() || "Unnamed project (fill later)";
        const goal = fields.goal.value.trim();

        const stack = mergePresetAndText(fields.stackPreset, fields.stack);
        const arch = mergePresetAndText(
          fields.architecturePreset,
          fields.architecture
        );
        const features = fields.features.value.trim();
        const nonneg = mergePresetAndText(
          fields.nonnegPreset,
          fields.nonnegotiables
        );
        const tests = mergePresetAndText(fields.testsPreset, fields.tests);
        const style = mergePresetAndText(fields.stylePreset, fields.style);
        const overkill = mergePresetAndText(
          fields.overkillPreset,
          fields.overkill
        );
        const constraints = mergePresetAndText(
          fields.constraintsPreset,
          fields.constraints
        );

        const blocks = [];

        // SYSTEM ROLE: Overkill, anti-drift, spec-enforcer
        blocks.push(
          `SYSTEM ROLE:\nYou are an obsessive, elite senior software engineer and code generation engine.\n\nYou do NOT build MVPs. You aggressively over-engineer for robustness, classroom chaos, and weird edge cases. You treat this prompt as a binding spec: missing features or specs count as a failure.\n\nYou produce extremely large, production-grade, multi-file codebases with minimal explanation, prioritizing:\n- Zero drift from the spec\n- Over-complete implementations (never under-built)\n- Clear, boring, maintainable architecture`
        );

        // PROJECT CONTEXT
        blocks.push(
          `PROJECT CONTEXT:\nName: ${name}\n\nOVERALL GOAL:\n${
            goal ||
            "(The user has not provided a detailed goal; infer from other sections but be explicit about assumptions at the top of the main file.)"
          }`
        );

        // STACK
        blocks.push(
          `TECH STACK & PLATFORM:\n${
            stack ||
            "(Infer a reasonable, modern stack that fits a GitHub + Render or Apps Script deployment. Make your choice explicit at the top of the answer and stick to it.)"
          }`
        );

        // ARCHITECTURE
        blocks.push(
          `ARCHITECTURE & STRUCTURE:\n${
            arch ||
            "(Propose a sane, modular structure with clear folders, entry points, and separation of concerns. Keep all code in a single answer but clearly separated by file headers.)"
          }`
        );

        // FEATURES
        blocks.push(
          `CORE FEATURES & FLOWS:\n${
            features ||
            "(Design the core flows yourself: initialization, main gameplay/app loop, teacher views, student flows, scoring, logging, and any critical admin screens. Implement them as real, callable code, not comments.)"
          }`
        );

        // NON-NEGOTIABLES
        blocks.push(
          `NON-NEGOTIABLES:\n${
            nonneg ||
            "(Avoid external services unless explicitly requested; avoid dangerous APIs; keep the code understandable for teachers; deployment from GitHub + Render or Apps Script must be straightforward.)"
          }`
        );

        // TESTS & SAFETY
        blocks.push(
          `TESTING, LOGGING & SAFETY:\n${
            tests ||
            "(Include at least basic error handling, clear error messages, and either a small but real test harness or a clearly described manual testing mode appropriate for the stack.)"
          }`
        );

        // STYLE
        blocks.push(
          `STYLE & COMMENTS:\n${
            style ||
            "(Code must be readable by a busy teacher; use short, purposeful comments and explicit function names; keep configuration centralized; avoid clever abstractions that hide behavior.)"
          }`
        );

        // OVER-ENGINEERING BLOCK
        blocks.push(
          `OVER-ENGINEERING & ROBUSTNESS:\n${
            overkill ||
            "- This is not an MVP. Overbuild for robustness and resilience.\n- Implement reset/restart flows so a teacher can safely restart between classes.\n- Add small internal tools (debug flags, logging helpers) as long as they stay consistent with the theme.\n- Prefer extra guardrails over minimal code."
          }`
        );

        // ZERO-DRIFT CONTRACT
        blocks.push(
          `ZERO-DRIFT CONTRACT:\n- Treat EVERY bullet and section in this prompt as a binding requirement.\n- Do not silently drop, merge, or simplify features.\n- If something is ambiguous, choose the interpretation that maximizes robustness and internal consistency.\n- Implement every described feature as actual code pathways, not only comments.\n- Do NOT change the narrative, theme, or mechanics unless explicitly allowed.\n- Under no circumstance replace requested code with prose summaries.`
        );

        // GENERATION STRATEGY
        blocks.push(
          `GENERATION STRATEGY & TOKEN USAGE:\n${
            constraints ||
            `- Use the maximum safe output size available.\n- Output code FIRST, explanations LAST.\n- Use clear file headers like:\n  // file: Code.gs\n  // file: index.html\n  // file: frontend/app.js\n- Do NOT wrap the entire output in markdown fences.\n- If forced to truncate, prioritize core runnable code (game/app loop, state management, persistence, teacher controls) over cosmetic extras.`
          }`
        );

        // OUTPUT FORMAT
        blocks.push(
          `OUTPUT FORMAT:\n- Single answer containing ALL files.\n- Each file prefixed with a clear comment header.\n- No markdown fences around the entire output.\n- Short explanation AFTER all code if there is space.\n- Make it obvious which parts belong in which files so the user can copy-paste directly.`
        );

        const promptText = blocks.join(
          "\n\n==============================\n\n"
        );
        finalPrompt.value = promptText;
        statusEl.textContent =
          "Prompt built. Copy it and paste into Unhinged Codex.";
      }

      function resetInputs() {
        Object.values(fields).forEach((el) => {
          if (!el) return;
          if (el.tagName === "SELECT") {
            el.value = "";
          } else {
            el.value = "";
          }
        });
        finalPrompt.value = "";
        statusEl.classList.remove("error");
        statusEl.textContent =
          "Inputs cleared. Fill them again and click Create Prompt.";
      }

      async function copyToClipboard() {
        const text = finalPrompt.value.trim();
        if (!text) {
          statusEl.classList.add("error");
          statusEl.textContent = "Nothing to copy yet. Build a prompt first.";
          return;
        }

        try {
          await navigator.clipboard.writeText(text);
          statusEl.classList.remove("error");
          statusEl.textContent = "Copied superprompt to clipboard.";
        } catch (err) {
          console.error("Clipboard error:", err);
          statusEl.classList.add("error");
          statusEl.textContent =
            "Could not access clipboard. Select and copy manually.";
        }
      }

      buildBtn.addEventListener("click", buildSuperprompt);
      resetBtn.addEventListener("click", resetInputs);
      copyBtn.addEventListener("click", copyToClipboard);
    </script>
  </body>
</html>
